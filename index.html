<!DOCTYPE html>
<html>
<head>
    <title>EVE Online SPA</title>
</head>
<body>
    <h1>EVE Online SPA</h1>
    <p>Welcome to your EVE Online single-page application!</p>
    <button id="login-button">Log in with EVE Online</button>

    <script>
        function generateState() {
            var state = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            for (var i = 0; i < 16; i++) {
                state += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return state;
        }

        var state = generateState();
        document.getElementById('login-button').addEventListener('click', function() {
            // Redirect the user to the EVE SSO login page
            window.location.href = 'https://login.eveonline.com/v2/oauth/authorize/?response_type=code&redirect_uri=https%3A%2F%2Ffriendly-puppy-d4bfa8.netlify.app%2Fcallback&client_id=8becdadbea7d46adabbcf20af467fac8&scope=esi-killmails.read_killmails.v1&state=' + state;
        });

        // Check if access token is available in the URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const accessToken = urlParams.get('access_token');

        // If access token is available, make the fetch request
        if (accessToken) {
            fetch('https://esi.evetech.net/v1/characters/2117504100/killmails/recent/', {
                headers: {
                    Authorization: 'Bearer ' + accessToken,
                },
            })
            .then(response => response.json())
            .then(data => {
                // Process the data (killmails) and display them in your SPA
                console.log(data);
            })
            .catch(error => {
                // Handle any errors
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
