<!DOCTYPE html>
<html>
<head>
    <title>Killmails Display with EVE Online SSO</title>
    <style>
        body {
            background-color: black;
            color: green;
            font-weight: bold;
        }
        .kill {
            display: inline-block;
            text-align: center;
            margin-right: 10px;
        }
        .kill img {
            display: block;
            margin-bottom: 5px;
        }
        #login {
            background: none;
            border: none;
        }
        #login img {
            width: auto;
            height: 30px;
        }
    </style>
</head>
<body>
    <button id="login">
        <img src="https://web.ccpgamescdn.com/eveonlineassets/developers/eve-sso-login-white-small.png" alt="Log in with EVE Online">
    </button>
    <div id="killsContainer"></div>

    <script src="https://cdn.auth0.com/js/auth0-spa-js/1.13/auth0-spa-js.production.js"></script>
    <script>
        // Initialize Auth0 client
        const auth0 = new Auth0Client({
            domain: 'dev-1yura1lcjrsavb5f.us.auth0.com',
            client_id: 'Vsxotf2mTJ5Nx1sra4vYQueHQhMNt6vk',
            redirect_uri: 'https://o7eve.github.io/',
            audience: 'https://esi.evetech.net'
        });

        // Handle login
        document.getElementById('login').addEventListener('click', async () => {
            await auth0.loginWithRedirect({
                connection: 'EVEOnlineSSO',
                scope: 'esi-killmails.read_killmails.v1'
            });
        });

        // Handle authentication response
        window.onload = async () => {
            if (await auth0.isAuthenticated()) {
                const accessToken = await auth0.getTokenSilently();
                fetchKillmails(accessToken);
            } else if (window.location.search.includes('code=')) {
                await auth0.handleRedirectCallback();
                window.history.replaceState({}, document.title, '/');
            }
        };

        // Fetch and display killmails
        async function fetchKillmails(accessToken) {
            const killsContainer = document.getElementById('killsContainer');
            killsContainer.innerHTML = '';

            // Fetch last 10 kills for the character (you need to implement this)
            const killmails = await getLast10Killmails(accessToken);

            // Display killmails (similar to previous implementation)
            for (const killmail of killmails) {
                const killElement = document.createElement('div');
                killElement.className = 'kill';
                killElement.innerHTML = `
                    <img src="https://images.evetech.net/types/${killmail.shipTypeId}/icon" alt="Ship Icon">
                    <span>${formatValue(killmail.value)}</span>
                `;
                killsContainer.appendChild(killElement);
            }
        }

        function formatValue(value) {
            // Format the value in millions or billions (similar to previous implementation)
        }
    </script>
</body>
</html>
