<!DOCTYPE html>
<html>
<head>
    <title>EVE Onlinssse SPA</title>
    <style>
        body {
            background-color: black;
            color: green;
            font-weight: bold;
        }
        .kill {
            display: inline-block;
            text-align: center;
            margin-right: 10px;
        }
        .kill img {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>EVE Online SPA</h1>
    <p>Welcome to your EVE Online single-page application!</p>
    <button id="login-button">Log in with EVE Online</button>

    <div id="killmails-container"></div>
    <div id="countdown-timer">Refreshing in 60 seconds...</div>
    <div id="character-info"></div>

    <script>
        let accessToken = '';
        let refreshToken = '';
        let characterId = '';

        document.getElementById('login-button').addEventListener('click', function() {
            // Login logic remains the same
        });

        // Token fetching and extraction logic remains the same

        function fetchAndDisplayKillmails() {
            fetch(`https://esi.evetech.net/v1/characters/${characterId}/killmails/recent/`, {
                headers: {
                    Authorization: 'Bearer ' + accessToken,
                },
            })
            .then(response => response.json())
            .then(data => {
                // Filter and sort the killmails before displaying
                let processedKillmails = [];
                let promises = data.map(killmail => fetch(`https://esi.evetech.net/v1/killmails/${killmail.killmail_id}/${killmail.killmail_hash}/`)
                    .then(response => response.json())
                    .then(details => {
                        if (details.victim.character_id !== parseInt(characterId)) {
                            // If the character is not the victim, add the killmail to the array
                            return {
                                ...details,
                                killmail_time: killmail.killmail_time // Include the killmail time for sorting
                            };
                        }
                    })
                );

                Promise.all(promises).then(results => {
                    processedKillmails = results.filter(killmail => killmail !== undefined); // Remove undefined results (where character was the victim)
                    processedKillmails.sort((a, b) => new Date(b.killmail_time) - new Date(a.killmail_time)); // Sort by killmail time

                    const killmailsContainer = document.getElementById('killmails-container');
                    killmailsContainer.innerHTML = '';

                    processedKillmails.slice(0, 10).forEach(killmail => {
                        const shipTypeId = killmail.victim.ship_type_id;
                        const shipIconUrl = `https://images.evetech.net/types/${shipTypeId}/icon`;

                        const killmailElement = document.createElement('div');
                        killmailElement.className = 'kill';
                        killmailElement.innerHTML = `
                            <img src="${shipIconUrl}" alt="Ship Icon">
                            <span>Value Placeholder</span> <!-- Adjust as necessary -->
                        `;
                        killmailsContainer.appendChild(killmailElement);
                    });
                });
            })
            .catch(error => {
                console.error('Error fetching recent killmails:', error);
            });
        }

        // Remaining logic for extracting character info, calculating kill value, etc., remains the same
    </script>
</body>
</html>
